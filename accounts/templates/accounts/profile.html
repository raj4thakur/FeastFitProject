{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FeastFit - Profile page for managing recipes, preferences, and account settings.">
    <title>FeastFit - Profile</title>
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <script src="{% static 'js/profile.js' %}" defer></script>
</head>

<body>
    <header>
        <div class="header-container">
            <a href="/" class="logo-link">
                <div class="logo">
                    <span>FeastFit</span>
                    <p>Recipe and Diet Planner</p>
                </div>
            </a>
            <nav class="nav-container">
                <ul class="nav-links">
                    <li><a href="/" class="active">Home</a></li>
                    <li><a href="{% url 'accounts:login' %}">SignIn</a></li>
                    <li><a href="/recipes">Recipes</a></li>
                    <li><a href="{% url 'feast_recipes:upload_recipe' %}">Upload Recipe</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <input type="text" placeholder="Search Recipe..." class="search-bar">
                </ul>
            </nav>
            <div class="profile-container">
                {% if user.is_authenticated %}
                <a href="{% url 'accounts:profile' %}" class="profile-link" aria-label="View Profile">
                    <img src="{{ user.profile.profile_pic.url }}" alt="Profile Picture of {{ user.username }}" class="profile-pic">
                </a>
                {% else %}
                <a href="{% url 'accounts:login' %}" class="login-link" aria-label="Login">Login</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="profile-page">
        <div class="profile-container">
            <!-- Profile Info -->
            <section class="profile-info" aria-labelledby="profile-header">
                <h1 id="profile-header">{{ user.username }}'s Profile</h1>
                <img src="{{ user.profile.profile_pic.url }}" alt="Profile Picture of {{ user.username }}" class="profile-pic">
                <form id="profileForm" action="{% url 'accounts:upload_profile_pic' %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="file" id="newProfilePic" name="new_profile_pic" accept="image/*" aria-label="Choose a new profile picture">
                    <button type="submit">Upload</button>
                </form>
            </section>
            
            <div class="container">
                <!-- Sidebar Navigation -->
                <aside class="sidebar" aria-label="Profile navigation">
                    <nav>
                        <ul>
                            <li><a href="#general-info" class="nav-link active">General Information</a></li>
                            <li><a href="#dietary-prefs" class="nav-link">Dietary Preferences</a></li>
                            <li><a href="#user-content" class="nav-link">User Content</a></li>
                            <li><a href="#community" class="nav-link">Community</a></li>
                            <li><a href="#account-security" class="nav-link">Account Security</a></li>
                            <li><a href="#additional-options" class="nav-link">Additional Options</a></li>
                        </ul>
                    </nav>
                </aside>

                <!-- Content Sections -->
                <div class="profile-content">
                    <!-- General Info -->
                    <section id="general-info" class="content-section active">
                        <h2>Profile Information</h2>
                        <form action="{% url 'accounts:update_profile' %}" method="post">
                            {% csrf_token %}
                            <label for="username">Username:</label>
                            <input type="text" id="username" name="username" value="{{ user.username }}" readonly>

                            <label for="full-name">Full Name:</label>
                            <input type="text" id="full-name" name="full_name" value="{{ user.profile.full_name }}" required>

                            <label for="gender">Gender:</label>
                            <select id="gender" name="gender">
                                <option value="male" {% if user.profile.gender == 'male' %}selected{% endif %}>Male</option>
                                <option value="female" {% if user.profile.gender == 'female' %}selected{% endif %}>Female</option>
                                <option value="other" {% if user.profile.gender == 'other' %}selected{% endif %}>Other</option>
                            </select>

                            <label for="birthdate">Date of Birth:</label>
                            <input type="date" id="birthdate" name="birthdate" value="{{ user.profile.birthdate|date:'Y-m-d' }}">

                            <label for="email">Email:</label>
                            <input type="email" id="email" name="email" value="{{ user.email }}">

                            <label for="country">Country:</label>
                            <input type="text" id="country" name="country" value="{{ user.profile.country }}">
                            

                            <button type="submit">Save Changes</button>
                        </form>
                    </section>

                    <!-- Dietary Preferences -->
                    <section id="dietary-prefs" class="content-section">
                        <h2>Dietary Preferences</h2>
                        <form action="{% url 'accounts:update_dietary_preferences' %}" method="post">
                            {% csrf_token %}
                            <label>Preferred Diet:</label>
                            {% for diet in diets %}
                            <input type="checkbox" name="preferred_diet" value="{{ diet.name }}" {% if diet.name in user.profile.preferred_diet %}checked{% endif %}>
                            {{ diet.name }}
                            {% endfor %}

                            <label for="allergies">Allergies:</label>
                            <input type="text" id="allergies" name="allergies" value="{{ user.profile.allergies }}">

                            <label for="caloric-goals">Caloric Intake Goals:</label>
                            <input type="number" id="caloric-goals" name="caloric_goals" value="{{ user.profile.caloric_goals }}">

                            <button type="submit">Save Preferences</button>
                        </form>
                    </section>
                    <section id="user-content" class="content-section">
                        <h2>User Content</h2>
                        <div>
                            <h3>My Recipes</h3>
                            {% if recipes %}
                            <div class="recipe-gallery">
                                {% for recipe in recipes %}
            <div class="recipe-card">
                <a href="{% url 'feast_recipes:recipe_content' recipe.id %}">
                    <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
                </a>
                <form method="POST">
                    {% csrf_token %}
                    <button
                        class="like-button {% if liked %}liked{% endif %}"
                        data-recipe-id="{{ recipe.id }}"
                        data-url="{% url 'feast_recipes:like_recipe' recipe.id %}"
                        data-isliked="{{ liked|yesno:'true,false' }}">
                        {{ recipe.likes }} ü§ç
                    </button>
                </form>
                <h3>{{ recipe.title }}</h3>
                <div class="user-info">
                    <img src="profile_pics/default.png" alt="User Profile" class="profile-pic">
                    <span class="user-name">FeastFit</span>
                </div>
                <h4>{{ recipe.description }}</h4>
                <div class="recipe-bottom">
                    <p>
                        {{ recipe.cuisine }} | 
                        <span class="diet-badge diet-{{ recipe.diet_type}}">
                            {{ recipe.diet_type }}
                        </span>
                    </p>   
                    <div class="recipe-info">
                        <div class="views-container">
                            <span class="views-count">{{ recipe.views }} Views</span>
                        </div>
                        <div class="rating-container">
                            <div class="static-rating" data-average-rating="{{ recipe.average_rating }}" data-total-reviews="{{ recipe.total_reviews }}">
                                <!-- Stars will be dynamically generated here -->
                                <div class="stars"></div>
                                <!-- Total Reviews -->
                                <span class="reviews-count"></span>
                            </div>
                        </div>
                    </div>
                    <a href="{% url 'feast_recipes:recipe_content' recipe.id %}" class="cta-button-r">View Recipe</a>
                    <div class="card-actions">
                        <button class="share-button">
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                        <button class="save-button" data-recipe-id="{{ recipe.id }}">
                            <i class="fas fa-bookmark"></i> Save
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}

                            </div>
                            {% else %}
                                <p>You haven't uploaded any recipes yet.</p>
                            {% endif %}
                        </div>
                        <div>
                            <h3>Saved Recipes</h3>
                            {% if saved_recipes %}
                            <div class="recipe-gallery">
                                {% for saved in saved_recipes %}
                                <div class="recipe-card" data-recipe-id="{{ saved.recipe.id }}">
                                    <a href="{% url 'feast_recipes:recipe_content' saved.recipe.id %}">
                                        <img src="{{ saved.recipe.image.url }}" alt="{{ saved.recipe.title }}">
                                    </a>
                                    <button 
                                        class="like-button {% if saved.recipe.liked %}liked{% endif %}" 
                                        data-recipe-id="{{ saved.recipe.id }}" 
                                        data-url="{% url 'feast_recipes:like_recipe' saved.recipe.id %}">
                                        <span class="like-icon">{% if saved.recipe.liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</span>
                                        <span class="like-count">{{ saved.recipe.likes }}</span>
                                    </button>
                                    <h3>{{ saved.recipe.title }}</h3>
                                    <div class="creator-details">
                                        <img src="media/{{ saved.recipe.user.profile.profile_pic }}" alt="Profile Picture" class="profile-pic">
                                        <span>Created by: {{ saved.recipe.user.username }}</span>
                                    </div>                                                          
                                    <p>{{ saved.recipe.description }}</p>
                                    <div class="recipe-bottom">
                                        <p>
                                            {{ saved.recipe.cuisine }} | 
                                            <span class="diet-badge diet-{{ saved.recipe.diet_type }}">
                                                {{ saved.recipe.diet_type }}
                                            </span>
                                        </p>                        
                                        <div class="recipe-info">
                                            <div class="views-container">
                                                <span class="views-count">{{ saved.recipe.views }} Views</span>
                                            </div>
                                            <div class="rating-container">
                                                <div class="static-rating" data-average-rating="{{ saved.recipe.average_rating }}" data-total-reviews="{{ saved.recipe.total_reviews }}">
                                                    <div class="stars"></div>
                                                    <span class="reviews-count"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <a href="{% url 'feast_recipes:recipe_content' saved.recipe.id %}" class="cta-button">View Recipe</a>
                                        <div class="card-actions">
                                            <button class="share-button">
                                                <i class="fas fa-share-alt"></i> Share
                                            </button>
                                            <button
                                                class="save-button {% if saved.recipe.is_saved %}saved{% endif %}"
                                                data-recipe-id="{{ saved.recipe.id }}"
                                                data-url="{% url 'feast_recipes:save_recipe' saved.recipe.id %}">
                                                <i class="fas fa-bookmark"></i> Save
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                                <p>You haven't saved any recipes yet.</p>
                            {% endif %}
                        </div>
                    </section>


                    <!-- Community -->
                    <section id="community" class="content-section">
                        <h2>Community</h2>
                        <div>
                            <h3>My Comments</h3>
                            <ul>
                                {% for comment in user.comments.all %}
                                <li>{{ comment.text }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </section>

                    <!-- Account Security -->
                    <section id="account-security" class="content-section">
                        <h2>Account Security</h2>
                        <form action="{% url 'accounts:update_security_settings' %}" method="post">
                            {% csrf_token %}
                            <label for="password">Password:</label>
                            <input type="password" id="password" name="password" required>

                            <label for="security-questions">Security Question:</label>
                            <select id="security-questions" name="security_question">
                                <option value="favorite-food">What is your favorite food?</option>
                            </select>

                            <label for="two-factor-auth">Two-Factor Authentication:</label>
                            <input type="checkbox" id="two-factor-auth" name="two_factor_auth" {% if user.profile.two_factor_auth %}checked{% endif %}>
                            <label for="two-factor-auth">Enable 2FA</label>

                            <button type="submit">Save Changes</button>
                        </form>
                    </section>

                    <!-- Additional Options -->
                    <section id="additional-options" class="content-section">
                        <h2>Additional Options</h2>
                        <ul>
                            <li><a href="{% url 'accounts:help_support' %}">Help and Support</a></li>
                            <li><a href="{% url 'accounts:feedback' %}">Feedback</a></li>
                            <li><a href="{% url 'accounts:logout' %}">Logout</a></li>
                        </ul>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <p>&copy; 2024 FeastFit. All rights reserved.</p>
    </footer>
</body>
</html>
